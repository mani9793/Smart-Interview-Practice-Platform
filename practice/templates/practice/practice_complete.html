{% extends 'base.html' %}
{% block title %}Session complete – Practice{% endblock %}
{% block content %}
<div class="card card-sip shadow-sm p-4">
    <div class="text-center mb-4">
        <i class="bi bi-check-circle-fill text-success display-4"></i>
        <h1 class="page-title h3 mt-2 mb-1 text-sip">{% if time_ran_out %}Time's up!{% else %}Session complete{% endif %}</h1>
        <p class="text-muted-sip mb-0">{% if time_ran_out %}Your time limit for <strong>{{ session.question_set.name }}</strong> has ended. Here are your answers so far.{% else %}You've answered all questions in <strong>{{ session.question_set.name }}</strong>.{% endif %}</p>
        {% if session.ended_at %}
        <p class="text-muted-sip small mt-2 mb-0"><strong>Total time:</strong> {{ session.duration_display }}</p>
        {% endif %}
    </div>

    {% if responses %}
        <h2 class="h5 fw-semibold mb-3 mt-4 text-sip"><i class="bi bi-chat-left-text me-2"></i>Your answers</h2>
        <div class="list-group list-group-flush">
            {% for response in responses %}
                <div class="list-group-item list-item-sip px-0 pb-4 mb-3 rounded">
                    <p class="text-muted-sip small mb-2">
                        <span class="badge bg-secondary rounded-pill me-2">#{{ forloop.counter }}</span>
                        <span class="badge {% if response.question.difficulty == 'easy' %}badge-easy{% elif response.question.difficulty == 'hard' %}badge-hard{% else %}badge-medium{% endif %} rounded-pill">{{ response.question.get_difficulty_display }}</span>
                    </p>
                    <p class="text-uppercase text-muted-sip small fw-semibold mb-1" style="letter-spacing: 0.04em;">Question</p>
                    <div class="session-q-block rounded p-3 mb-3 text-break fw-bold">{{ response.question.text|linebreaksbr }}</div>
                    <p class="text-uppercase text-muted-sip small fw-semibold mb-1 mt-3" style="letter-spacing: 0.04em;">Answer</p>
                    <div class="session-a-block rounded p-3 text-break">
                        {% if response.answer_text %}
                            {{ response.answer_text|linebreaksbr }}
                        {% else %}
                            <span class="text-muted-sip fst-italic">No answer saved.</span>
                        {% endif %}
                    </div>
                    {% if response.self_rating %}
                    <p class="text-uppercase text-muted-sip small fw-semibold mb-1 mt-3" style="letter-spacing: 0.04em;">Self-rating</p>
                    <p class="mb-0" style="font-size: 1.25rem;">{% for i in "12345" %}{% if forloop.counter <= response.self_rating %}<span style="color: #e6b800;">★</span>{% else %}<span class="text-muted-sip">☆</span>{% endif %}{% endfor %}</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="d-flex justify-content-center gap-2 flex-wrap mt-4 pt-3 border-top">
        <a href="{% url 'practice:practice_index' %}" class="btn btn-sip-primary">
            <i class="bi bi-play-fill me-1"></i>Start another session
        </a>
        <a href="{% url 'practice:history' %}" class="btn btn-outline-primary">
            <i class="bi bi-clock-history me-1"></i>View history
        </a>
    </div>
</div>
{% block extra_css %}
<style>
.session-q-block {
    background: var(--sip-subtle);
    border: 1px solid var(--sip-border);
    border-left: 3px solid var(--sip-primary);
    font-size: 1.05rem;
    line-height: 1.5;
    color: var(--sip-text);
}
.session-a-block {
    background: var(--sip-subtle);
    border: 1px solid var(--sip-border);
    font-size: 1rem;
    line-height: 1.55;
    color: var(--sip-text);
}
</style>
{% endblock %}
{% endblock %}
